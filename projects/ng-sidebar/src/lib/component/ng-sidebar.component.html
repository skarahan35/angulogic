<div
  [class]="'ng-sidebar ' + sidebarData.options.cssClass"
  #sidebar
  id="ng-sidebar"
  [style.width]="
    sidebarData.options.expand
      ? sidebarData.options.width + 'px'
      : 'var(--collapse-width)'
  "
  [style.maxWidth]="
    sidebarData.options.expand ? sidebarData.options.maxWidth + 'px' : 'unset'
  "
  [style.minWidth]="
    sidebarData.options.expand ? sidebarData.options.minWidth + 'px' : 'unset'
  "
  [ngClass]="{
    collapsed: !sidebarData.options.expand,
    transition: !ngSidebarService.isResizing,
  }"
  (mouseenter)="onEnter()"
  (mouseleave)="onLeave()">
  <div
    *ngIf="sidebarData.options.resize && this.sidebarData.options.expand"
    class="resizer"
    (mousedown)="ngSidebarService.resize(sidebarData)"
    [ngClass]="{ active: ngSidebarService.isResizing }"></div>

  <div class="banner">
    <div *ngIf="sidebarData.bannerOptions" class="banner-container">
      <img
        *ngIf="sidebarData.bannerOptions.logo"
        [src]="sidebarData.bannerOptions.logo"
        (click)="onBannerClick('logo')"
        class="logo" />
      <div
        *ngIf="sidebarData.bannerOptions.title && sidebarData.options.expand"
        class="title text-owerflow"
        (click)="onBannerClick('title')">
        {{ sidebarData.bannerOptions.title }}
      </div>
    </div>

    <img
      *ngIf="sidebarData.options.viewMode === 'toggle'"
      (click)="onToggle(sidebarData.options.expand)"
      class="toggle-icon"
      [src]="
        sidebarData.options.expand
          ? sidebarData.options.toggleCollapseIcon
          : sidebarData.options.toggleExpandIcon
      " />

    <img
      *ngIf="sidebarData.options.viewMode === 'hover'"
      (click)="onPin()"
      class="toggle-icon"
      [src]="
        sidebarData.options.pinned
          ? sidebarData.options.unpinIcon
          : sidebarData.options.pinIcon
      " />
    <ng-content select="[al-sidebar-banner]"></ng-content>
  </div>

  <div *ngIf="sidebarData.userOptions?.position == 'top'">
    <ng-container
      *ngTemplateOutlet="
        userTemplate;
        context: { $implicit: sidebarData.userOptions }
      "></ng-container>
  </div>

  <div
    class="search"
    *ngIf="sidebarData.options.search && sidebarData.options.expand"
    [ngClass]="sidebarData.searchOptions?.cssClass">
    <img class="search-icon" src="assets/icons/search.svg" />
    <input
      #searchInput
      (keyup)="onSearch($event)"
      [placeholder]="sidebarData.searchOptions?.placeholder ?? ''"
      type="text" />
    <img
      (click)="onCancelSearch(searchInput)"
      class="cancel-icon"
      src="assets/icons/cancel.svg"
      alt />

    <ng-content select="[al-sidebar-search]"></ng-content>
  </div>

  <div class="menu-container">
    <div
      class="wrapper"
      [ngClass]="data.cssClass"
      *ngFor="let data of sidebarData.sidebarData">
      <ng-container *ngIf="data.visible">
        <div class="title-wrapper">
          <img *ngIf="data.icon" [src]="data.icon" />
          <div *ngIf="sidebarData.options.expand" class="title">
            {{ data.title }}
          </div>
        </div>
        <ng-container *ngIf="sidebarData.options.expand">
          <ng-container
            *ngTemplateOutlet="
              dataTemplate;
              context: { $implicit: data.data }
            "></ng-container>
        </ng-container>
      </ng-container>
    </div>
    <ng-content select="[al-sidebar-menu]"></ng-content>
  </div>

  <div *ngIf="sidebarData.userOptions?.position == 'bottom'">
    <ng-container
      *ngTemplateOutlet="
        userTemplate;
        context: { $implicit: sidebarData.userOptions }
      "></ng-container>
  </div>
</div>

<ng-template #dataTemplate let-nodes>
  <div class="node" *ngFor="let node of nodes">
    <div
      class="node-info"
      (click)="onMenuClick(node, $event)"
      [ngClass]="{ 'no-child': !node.children, active: node.active }">
      <div class="node-title">
        <div class="icon-container">
          <img *ngIf="node.icon" [src]="node.icon" />
        </div>
        {{ node.name }}
      </div>
      <div *ngIf="node.children">
        <img
          class="node-toggler transition"
          [ngClass]="{ expand: node.isExpanded }"
          src="assets/icons/node-toggle.svg"
          alt />
      </div>
    </div>
    <ng-container
      *ngIf="node.children && node.children.length > 0 && node.isExpanded">
      <ng-container
        *ngTemplateOutlet="
          dataTemplate;
          context: { $implicit: node.children }
        "></ng-container>
    </ng-container>
  </div>
</ng-template>

<ng-template #userTemplate let-user>
  <div class="user-container" [ngClass]="{
    open: sidebarData.options.expand,
    close: !sidebarData.options.expand
  }">

    <div class="user" [ngClass]="user.cssClass">
      <img [src]="user.avatar" />
      <div *ngIf="sidebarData.options.expand" class="name">
        {{ user.name }}
      </div>
    </div>
    <div class="theme-toggler">
      <al-theme-toggler></al-theme-toggler>
    </div>

  </div>
</ng-template>
