<div
  [class]="'ng-sidebar ' + sidebarData.options.cssClass"
  #sidebar
  id="ng-sidebar"
  [style.width]="
    sidebarData.options.expand
      ? sidebarData.options.width + 'px'
      : 'var(--collapse-width)'
  "
  [style.maxWidth]="
    sidebarData.options.expand ? sidebarData.options.maxWidth + 'px' : 'unset'
  "
  [style.minWidth]="
    sidebarData.options.expand ? sidebarData.options.minWidth + 'px' : 'unset'
  "
  [ngClass]="{
    collapsed: !sidebarData.options.expand,
    transition: !ngSidebarService.isResizing,
  }"
  (mouseenter)="onEnter()"
  (mouseleave)="onLeave()">
  <div
    *ngIf="sidebarData.options.resize"
    class="resizer"
    (mousedown)="ngSidebarService.resize(sidebarData)"
    [ngClass]="{ active: ngSidebarService.isResizing }"></div>

  <div class="banner">
    <div *ngIf="sidebarData.bannerOptions" class="banner-container">
      <img
        *ngIf="sidebarData.bannerOptions.logo"
        [src]="sidebarData.bannerOptions.logo"
        (click)="onBannerClick('logo')"
        class="logo" />
      <div
        *ngIf="sidebarData.bannerOptions.title && sidebarData.options.expand"
        class="title text-owerflow" (click)="onBannerClick('title')">
        {{ sidebarData.bannerOptions.title }}
      </div>
    </div>

    <img
      *ngIf="sidebarData.options.viewMode === 'toggle'"
      (click)="onToggle(sidebarData.options.expand)"
      class="toggle-icon"
      [src]="
        sidebarData.options.expand
          ? sidebarData.options.toggleCollapseIcon
          : sidebarData.options.toggleExpandIcon
      " />

    <img
      *ngIf="sidebarData.options.viewMode === 'hover'"
      (click)="onPin()"
      class="toggle-icon"
      [src]="
        sidebarData.options.pinned
          ? sidebarData.options.unpinIcon
          : sidebarData.options.pinIcon
      " />
    <ng-content
      *ngIf="!sidebarData.bannerOptions"
      select="[ng-sidebar-banner]"></ng-content>
  </div>

  <div class="search" [ngClass]="sidebarData.searchOptions?.cssClass">
    <img class="search-icon" src="assets/icons/search.svg" />
    <input
      (keyup)="onSearch($event)"
      [placeholder]="sidebarData.searchOptions?.placeholder ?? ''"
      type="text" />
    <img class="cancel-icon" src="assets/icons/cancel.svg" alt />
  </div>

  <div class="menu-container">
    <div
      class="wrapper"
      [ngClass]="data.cssClass"
      *ngFor="let data of sidebarData.sidebarData">
      <ng-container *ngIf="data.visible">
        <div class="title">
          {{ data.title }}
        </div>
        <ng-container
          *ngTemplateOutlet="
            dataTemplate;
            context: { $implicit: data.data }
          "></ng-container>
      </ng-container>
    </div>
  </div>

  <div class="ng-sidebar__header">
    <ng-content select="[ng-sidebar-header]"></ng-content>
  </div>
  <div class="ng-sidebar__content">
    <ng-content select="[ng-sidebar-content]"></ng-content>
  </div>
  <div class="ng-sidebar__footer">
    <ng-content select="[ng-sidebar-footer]"></ng-content>
  </div>
</div>

<ng-template #dataTemplate let-nodes>
  <div class="node" *ngFor="let node of nodes">
    <div class="node-info">
      <div class="node-title" (click)="onMenuClick(node)">
        <div class="icon-container">
          <img *ngIf="node.icon" [src]="node.icon" />
        </div>
        {{ node.name }}
      </div>
      <div (click)="nodeTogglerClick(node, $event)" *ngIf="node.children">
        <img
          class="node-toggler transition"
          [ngClass]="{ expand: node.isExpanded }"
          src="assets/icons/node-toggle.svg"
          alt />
      </div>
    </div>
    <ng-container
      *ngIf="node.children && node.children.length > 0 && node.isExpanded">
      <ng-container
        *ngTemplateOutlet="
          dataTemplate;
          context: { $implicit: node.children }
        "></ng-container>
    </ng-container>
  </div>
</ng-template>
